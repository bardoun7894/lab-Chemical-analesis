{% extends 'base.html' %}

{% block title %}Daily Production Report{% endblock %}

{% block content %}
<div class="container">
    <!-- Page Header -->
    <div class="row mb-4">
        <div class="col">
            <h2>
                <i class="bi bi-calendar-day"></i>
                {{ 'تقرير الإنتاج اليومي' if current_locale == 'ar' else 'Daily Production Report' }}
            </h2>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{{ url_for('reports.index') }}">{{ 'التقارير' if current_locale == 'ar' else 'Reports' }}</a></li>
                    <li class="breadcrumb-item active">{{ 'الإنتاج اليومي' if current_locale == 'ar' else 'Daily Production' }}</li>
                </ol>
            </nav>
        </div>
    </div>

    <!-- Date Filter -->
    <div class="card border-0 shadow-sm mb-4">
        <div class="card-body">
            <form method="GET" class="row g-3 align-items-end">
                <div class="col-md-4">
                    <label class="form-label">{{ 'تاريخ التقرير' if current_locale == 'ar' else 'Report Date' }}</label>
                    <input type="date" name="date" class="form-control" value="{{ report_date }}">
                </div>
                <div class="col-md-2">
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-search"></i>
                        {{ 'عرض' if current_locale == 'ar' else 'View' }}
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Summary Stats -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card border-0 shadow-sm bg-primary text-white">
                <div class="card-body text-center">
                    <h3 class="mb-0">{{ total }}</h3>
                    <small>{{ 'إجمالي الأنابيب' if current_locale == 'ar' else 'Total Pipes' }}</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-sm bg-success text-white">
                <div class="card-body text-center">
                    <h3 class="mb-0">{{ by_shift[1]|length }}</h3>
                    <small>{{ 'الوردية الأولى' if current_locale == 'ar' else 'Shift 1' }}</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-sm bg-warning text-dark">
                <div class="card-body text-center">
                    <h3 class="mb-0">{{ by_shift[2]|length }}</h3>
                    <small>{{ 'الوردية الثانية' if current_locale == 'ar' else 'Shift 2' }}</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-sm bg-info text-white">
                <div class="card-body text-center">
                    <h3 class="mb-0">{{ by_shift[3]|length }}</h3>
                    <small>{{ 'الوردية الثالثة' if current_locale == 'ar' else 'Shift 3' }}</small>
                </div>
            </div>
        </div>
    </div>

    <!-- By Diameter -->
    {% if by_diameter %}
    <div class="card border-0 shadow-sm mb-4">
        <div class="card-header bg-light">
            <h5 class="mb-0">
                <i class="bi bi-circle"></i>
                {{ 'حسب القطر' if current_locale == 'ar' else 'By Diameter' }}
            </h5>
        </div>
        <div class="card-body">
            <div class="row">
                {% for diameter, count in by_diameter.items() %}
                <div class="col-md-2 col-4 mb-2">
                    <div class="border rounded p-2 text-center">
                        <strong>DN {{ diameter }}</strong>
                        <div class="text-muted">{{ count }} {{ 'أنبوب' if current_locale == 'ar' else 'pipes' }}</div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Pipes Table -->
    <div class="card border-0 shadow-sm">
        <div class="card-header bg-light">
            <h5 class="mb-0">
                <i class="bi bi-table"></i>
                {{ 'تفاصيل الأنابيب' if current_locale == 'ar' else 'Pipe Details' }}
            </h5>
        </div>
        <div class="card-body p-0">
            {% if pipes %}
            <div class="table-responsive">
                <table class="table table-hover mb-0">
                    <thead class="table-light">
                        <tr>
                            <th>{{ 'الوردية' if current_locale == 'ar' else 'Shift' }}</th>
                            <th>{{ 'الرقم' if current_locale == 'ar' else 'No.' }}</th>
                            <th>{{ 'القطر' if current_locale == 'ar' else 'Diameter' }}</th>
                            <th>{{ 'الطول' if current_locale == 'ar' else 'Length' }}</th>
                            <th>{{ 'الحالة' if current_locale == 'ar' else 'Status' }}</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for pipe in pipes %}
                        <tr>
                            <td>
                                <span class="badge bg-{{ 'success' if pipe.shift == 1 else ('warning' if pipe.shift == 2 else 'info') }}">
                                    {{ pipe.shift or 1 }}
                                </span>
                            </td>
                            <td>
                                <a href="{{ url_for('pipes.detail', id=pipe.id) }}">{{ pipe.no_code }}</a>
                            </td>
                            <td>DN {{ pipe.diameter }}</td>
                            <td>{{ pipe.length }} m</td>
                            <td>
                                {% if pipe.status == 'OK' %}
                                <span class="badge bg-success">OK</span>
                                {% elif pipe.status == 'DEFECT' %}
                                <span class="badge bg-danger">Defect</span>
                                {% else %}
                                <span class="badge bg-secondary">{{ pipe.status or '-' }}</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="text-center py-5">
                <i class="bi bi-inbox display-4 text-muted"></i>
                <p class="text-muted mt-2">{{ 'لا يوجد إنتاج لهذا اليوم' if current_locale == 'ar' else 'No production for this date' }}</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
